/**
             .u+m.z"!!::~~~~!~"+!
          .*~~~*"~~~~~~~~~~~~~~~~~?L.
        :!~~~~~~~~~~~~~~~~~~~~~~~~~~~?#u
       ?~~~~~~~~~~~~~~~~~~~~~~~~~~~~!:~~~"e.         .
     .2~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"**WP*#**IS??X#"
     (~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~?X
    '~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~c
    '~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~z"   "
    '~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~H*F
    't/~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~>
    4~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~i:~~~~~~~~~+
   *~~~~~~~~~~~~~~~~~~~~~:~~~!~~~~~W$~~~~~~~~~~>
  :~~~~~~~~~~~~~~~~~~~~:u~~~X!K~~~~RMK~~~~~~~~~t
  !~~~~~~~~~~~~~~~~~~!d$R~:@UX$~~~4R!E$/~~~~~~~$
  ~~~~~~~~~~~~~~~~~~XRNF!\E??!$~~:$!?5$B~~~~~~~>
 :~~~~~~~~~~~~~~~~~$?$FX@!!!!!!~4RXt$$$F~~~~~~\       o@"
  >~~~~~~~:~~~~~~~3$#dRXWW8X!t!M!W$$$@$#N:~~~~F    dM$
  s~~~~~~~~%~~~~~u5$TR*$$$#N!M@$$$$Q$*#U~~~"?@! .'"~:
  'L~~~~~~~~~%U~4P&!!!!M**!!!X$!!!!!$~~~i~:~~~~~~~!~
    #i:~~~~~~~i~~~X!!!!!!!!!!!!!!!!!M~~~~!@F`%be~
       $TR%!~~M~~~t!!!!!!!!!!!UW!!!!@~~~:M
        ^i~~z!F~~~~NX!!!!!!!!!!!!!!tP~~f
          #M~~F~~~~W?X!!!tH$$$$$$!HF!tB
          #!~!!~~~~$!!!!!9$$$$R#"    M!**bc.
          %~!!$~~~~$W!!!!!$$$F     '9!!!!!!!?mu.
          !~!9$!~~~X?$&!!9#!$      !R!!!!!!!!!!!?$$N...
         :!!UR!$:~!$X!!$$%!!X     '$!!!!!!!!!!!!!!!!!!!?T#RRbeL.
        :?tM$!!!$~>~?KXR!!!!$>    '$!!!!!!!!!!!!!!!!!!!!!!!!!!!!?$$e.
        ^ R!!!!!!!#**$R!!!!!tk     9K!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!TR..
         @!!!!!!!!!M!!!!!!!!!R>    `R!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!@c
        /!!!!!!!!!!!!!!!!!!!!!$:    'B!!X!!!!!!XX!!!!!!!!!!!!!!!!!!!!!!!!!9*>
       ?!!!!!!!!!!!!!!!!!!!!!!!Mk     "K!!!!!!B$$s.C"*WWNWUUUUU!!!!!!!!!!!!!5
       X!!!!!!!!!!!!!!!!!!!!!!!!!%      ?&W$" ~  ~~~`N      `""""$$!!!!!!!!!M
       ?!!!!!!!!!!!!!!!!!!!!!!!!!!$>     `~  :~~~~~~~~Rr          'W!!!!!!!!!>
       4X!!!!!!!!!!!!!!!!!!!!!!!!!!$k       :~~~~~~~~~!$           $!!!!!!!!!>
       ::!!!!!!!!!!!!!!!!!!!!!!!!!!!MK.      `~~~~~~~~!+           !!!!!!!!!X
       '!$!!!!!!!!!!!!!!!!!!!!!!!!!!!M$  `!.  `~~~~~~!tL           $!!!!!!!!9
        !!#H!!!!!!!!!!!!!!!!!!!!!!!!!!?N   ~  ~!~~~~~X*            ?H!!!!!!!!
        !!!MX!!!!!!!!!!!!!!!!!!!!!!!!!!MN.      !Xi!t              4$!!!!!!!>
        H!!!$W!!!!!!!!!!!!!!!!!!!!!!!!!!XN        `>               4R!!!!!!!
       '!!!!!$K!!!!!!!!!!!!!!!!!!!!!!!!!!@        'N               4!!!!!!!E
        !!!!!!$$X!!!!!!X!!!!!!!!!!!!!!!!!!k        !               $!!!!!!M
        !!!!!!!T$NX!!!!!!!U!!!!!!!!!!!!!!!R        X               X!!!!!!f
       .!!!!!!!!$$*UX!!!!!!*X!!!!!!!!!!!!!&       '%               X!!!!!X
        R!!!!!!!!$  "NX!!!!!!!N!!!!!!!!!!XF        %               E!!!!X!
        $!!!!!!!!M>   ^"$X!!!!!!?W!!!!!!!9  :+".e>  !:             X!!!!!
        ?!!!!!!!!!L      ^*$WWX!!!TWX!!!tF:!\m".ued$$$$e          4!!!!!
        '!!!!!!!!!X           ^*NW!!9X!WFX~:B$$$$$$$$$$$k         d!!!!!
         E!!!!!!!!M               $&!$$\$b$5$$$$$$$$H?!!!!!!T!Rso!!!!!P
         '!!!!!!!!!!!!!$c           !$RMMMMMMMMMMRMMMMM$8MM$P!XXd!X#
           \!:!!!!!!!!!!!!#x        MMMMMMMMMMMMMMMMMMMM$$MM$H!Xf#
             :!!!!!!!!!!!!!!?T%..  XMMMMM8MMMMMMMMMMMMMMM$BMM$b
              #$UX:!!!!!!!!!!!!!!!MRRMMMM$MMMMMMMMMM$MMMMM$$MM$$>
                 ##NWX!!!!!!!!!!!@RMMMMM$$MMMMMMMMMMM$MMMMM$$8M$$k
                       "$@eii!:X$MMMMMM$$RMMMMMMMMMMM$MMMMMM$$MM$M$c
                            '"$$RMMMMMM$MMMMMMMMMMMMM$RMMMMMMM$BM$MM$.
                            :@$$MMMMMM$RMMMMMMMMMMMMM$$MMMMMMMM$$M$MM$r
                           d$$RMMMMM$$RMMMMM88$*#**#R$RRf"#$$$#$$$$$$MRN
                          $$RMMMMMMM$MMMM8RM$T~                 ""`?$$$$$b
                        u$RRMMMMMMMM$!?#****#~                      R$$$$$$.
                       @$RMMMMMM$$$$R                               !$MMMRM$R
                     J$$MMMMMM$*!!!!!                               ~$RMMMMM$b
                    xRM$MMM88$~  !!!!!~~        :::~~~~~~~~~~~~~:: ':9RMMMMMM$
                  .$RMMB$5$!     !!!!!!~~ :~~~~~~~~~~~~~~~~~~~~~~~~~~MRMMMMMM$
                 u$M$$$$$?~      !!!!!!!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~X$MMMMMM$
                d$$$$$B!~       ~~!!!!!!!!~~~~~~~~~~~~~~~~~~~~~~~~~~~X$MMMMMM$
              :$$$$M8$$!       ~~~!!!!!!!!~~~~~~~~~~~~~~~~~~~~~~~~~~~!MMMMMMMR
              $$$$RM$RM~       !!~!!!!!!!!~~~~~!~~~~~~~~~~~~~~~~~~~~~XRMMMMMM$
             d$$MM$$RMM      ~~~~:!!X!!!!!:!~~:/~::!!!~~~~~~~~~~~~~~~!RMMMMM$$
            $$RMM$$MMMM!  '!~~~~~!!!?X!!!!!!!!!!!!!!!!~~~~~~~~~~~~~~~XBMMMMMP
           J$MM$$$RMMMMB  ~~~~~~~~~!!M8!!!!!!!!!!!!!~~~~~~~~~~~~~~~~~9$MMMM$F
           $$RM$$MMMMMMMB:~~~~~~~~~~!!!RMWUUX!!!!~~~~~~~~~~~~~~~~~~~~MRMMM$$
           "RM$$MMMMMMMMMN!:!~~~~~~~!!!!M?$$!!~~~~~~~~~~~~~~~~~~~~~~~XM8$$$"
           $M$$MMMMMMMMMM$NX!!~~:~!!!!!?!!ME!!~~~~~~~~~~~~~~~~~~~~~~~W$#
           $$$MMMMMMMMMMMRR$W!!~!!!!!!!!!!9E~~~~~~~~~~~~~~~~~~~~~~~~!
           #$MMMMMMMMMMM$MMM$$!!~~~~~~~~~~MX~~~~~~~~~~~~~~~~~~~~~~~~X
            M$MMMMMMMMM$MMMMM$!!~~~~~~~~~~M!~~~~~~~~~~~~~~~~~~~~~~~~!
           *$$$$MMMMMMM$MMMMM$E~~~~~~~~~~~M!~~~~~~~~~~~~~~~~~~~~~~~~
             ^"#$MMMMM$RMMMMMRN!~~~~~~~~~~$!~~~~~~~~~~~~~~~~~~~~~~~/
                '$$CHAT958$$$$$!~~~~~~~~~~@!~~~~~~~~~~~~~~~~~~~~~~~!
                  '"     ""   "X~~~~~~~~~~R~~~~~~~~~~~~~~~~~~~~~~~~f
                               '!~~~~~~~~~H~~~~~~~~~~~~~~~~~~~~~~~~
                                `~~~~~~~~~XK~~~~~~~~~~~~~~~~~~~~~!(
                                "~~~~~~~~~4F~~~~~~~~~~~~~~~~~~~~~!F
                                ':~~~~~~~~!X~~~~~~~~~~~~~~~~~~~~~!
                                 !~~~~~~~~!R~~~~~~~~~~~~~~~~~~~~~`
                                 M~~~~~~~~~!:~~~~~~~~~~~~~~~~~~~~
                                  h~~~~~~~~4~~~~~~~~~~~~~~~~~~~~f
                                  !!~~~~~~~~!~~~~~~~~~~~~~~~~~~`
                                   R~~~~~~~~X~~~~~~~~~~~~~~~~~!
                                   'R~~~~~~~t!~~~~~~~~~~~~~~~~>
                                    *!~~~~~~*X~~~~~~~~~~~~~~~(
                                    'X~~~~~~!$~~~~~~~~~~~~~~!
                                     !~~~~~~!R~~~~~~~~~~~~~X
                                     '!~~~~~~t~~~~~~~~~~~~X"
                                      ?!~~~~~9~::~~~~~~~~!&
                                      '!~~~~~!!?~~~~~~~~~X~
                                       )~~~~~@t~~~~~~~~~!!
                                       n~~~~~B(~~~~~~~~~!~
                                       '~~~~!$~~~~~~~~~~`
                                        X~~~9~~~~~~~~~~!
                                        E~~~F~~~~~~~~~~!
                                        M!~4!~~~~~~~~~~`
                                        M!!M~~~~~~~~~~~`
                                        %~X!~~~~~~~~~~~
                                        ~!X~~~~~~~~~~~~
                                       M~t~~~~~~~~~~~~~>
                                      '~~$~~~~~~~~~~~~~
                                     :R~~T~~~~~~~~~~~~~
                                     M~~X~~~~~~~~~~~~~~M
                                    d~~~$~~~~~~~~~~~~~~K
                                   d~~~~R~~~~~~~~~~~~~~$
                                   R~~~X~~~~~~~~~~~~~~~?
                                  $~~~~9~~~~~~~~~~~~~~~X
                                 @M~~~~X~~~~~~~~~~~~~~~~
                                u~~~~~~8~~~~~~~~~~~~~~~t
                               -E~~~~~~$~~~~~~~~~~~~~~~9
                               '?~~~~~~$~~~~~~~~~~~~~~~9
                               $~~~~~~~$~~~~~~~~~~~~~~~?
                              :M~~~~~~~$~~~~~~~~~~~~~~~B
                              $X~~~~~~~X~~~~~~~~~~~~~~~$
                              X~~~~~~~~9~~~~~~~~~~~~~~~
                              R~~~~~~~~9~~~~~~~~~~~~~~~>
                             4K~~~~~~~~SE~~~~~~~~~~~~~~$
                              &~~~~~~~~@%~~~~~~~~~~~~~~F
                              R~~~~~~~~MW~~~~~~~~~~~~~t
                              K~~~~~~~~~$E~~~~~~~~~~~~t
                              $~~~~~~~~~M$~~~~~~~~~~~~*
                              J~~~~~~~~~M$~~~~~~~~~~~~f
                              4X~~~~~~~~~ME~~~~~~~~~~~F
                               $~~~~~~~~~t$X~~~~~~~~~~F
                               3~~~~~~~~~~M&~~~~~~~~~X>
                                K~~~~~~~~~$)~~~~~~~~~X
                                $~~~~~~~~9 'X~~~~~~~~$
                                $~~~~~~~~R  &~~~~~~~~>
                                 K~~~~~~X>  E~~~~~~~~r
                                 E~~~~~~$   4~~~~~~~~~
                                 $~~~~~~>   'X~~~~~~Mr
                                 .~~~~~H"   -@~~~~~~*
                                 *~~~~~~     $~~~~~~U
                                 @~~~~~$    '$~~~~~~X
                                 "~~~~~     4$~~~~~~t
                                 *~~~~$     ^$~~~~~~t
                                 ?~~~~#     4R~~~~~~t
                                 BXUX~R     J~~~~~~~X
                                R"  `$@     K~~~~~~~7
                              .J~    `t-   J$N~~~~~~$
                              M`      '5  M" 'N~~~~~M>
                             x         7$" '   W~~~~~F
                             $         8~       ~~~~~>
                            4&W~W:    t~        ~~~~~k
                            dE   ~~   9~        '~~~~t
                            -~. > ~~  ?f``h:    '~~~~~
                             M   ~$$X '&   `~~ ~ ~~~~~
                             $  d" K9  M>  'W$X  ~~~~~
                             $ X" 4E~X ~$> t~ 'tL'R~~~#
                             $'$  4~~% XF5'~    N)$~~~~r
                            .MM   4~~M XF$:~    4f~~~~~
                            ?~R   '~~$ ~$4>@    '&?~~~~@
                            M~    '~~T 'L R$    ^E~K~~~?
                            fX    ?~~9~ ~rSM     $(W~~~?
                           :E"    'K~?R `RM~  u  ~R)~~~~u
                                    4&9:  RX.    R9 X~~~M>
                                       **WM9X$   t~L #WU~X8m..
                                            ^"   $~$. `^""`  4N

 */

pragma solidity ^0.5.0;


/**
 * @dev Standard math utilities missing in the Solidity language.
 */
library Math {
    /**
     * @dev Returns the largest of two numbers.
     */
    function max(
        uint256 a, uint256 b) internal pure returns (uint256) {
        return a >= b ? a : b;
    }

    /**
     * @dev Returns the smallest of two numbers.
     */
    function min(uint256 a, uint256 b) internal pure returns (uint256) {
        return a < b ? a : b;
    }

    /**
     * @dev Returns the average of two numbers. The result is rounded towards
     * zero.
     */
    function average(uint256 a, uint256 b) internal pure returns (uint256) {
        // (a + b) / 2 can overflow, so we distribute
        return (a / 2) + (b / 2) + ((a % 2 + b % 2) / 2);
    }
}

library SafeMath {

    function add(uint256 a, uint256 b) internal pure returns (uint256) {
        uint256 c = a + b;
        require(c >= a, "SafeMath: addition overflow");

        return c;
    }

    function mul(uint256 a, uint256 b) internal pure returns (uint256) {
        if (a == 0) {
            return 0;
        }

        uint256 c = a * b;
        require(c / a == b, "SafeMath: multiplication overflow");

        return c;
    }
}

/*
 * @dev Provides information about the current execution context, including the
 * sender of the transaction and its data. While these are generally available
 * via msg.sender and msg.data, they should not be accessed in such a direct
 * manner, since when dealing with GSN meta-transactions the account sending and
 * paying for execution may not be the actual sender (as far as an application
 * is concerned).
 *
 * This contract is only required for intermediate, library-like contracts.
 */
contract Context {
    // Empty internal constructor, to prevent people from mistakenly deploying
    // an instance of this contract, which should be used via inheritance.
    constructor () internal { }
    // solhint-disable-previous-line no-empty-blocks

    function _msgSender() internal view returns (address payable) {
        return msg.sender;
    }

    function _msgData() internal view returns (bytes memory) {
        this; // silence state mutability warning without generating bytecode - see https://github.com/ethereum/solidity/issues/2691
        return msg.data;
    }
}

/**
 * @dev Contract module which provides a basic access control mechanism, where
 * there is an account (an owner) that can be granted exclusive access to
 * specific functions.
 *
 * This module is used through inheritance. It will make available the modifier
 * `onlyOwner`, which can be applied to your functions to restrict their use to
 * the owner.
 */
contract Ownable is Context {
    address private _owner;

    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);

    /**
     * @dev Initializes the contract setting the deployer as the initial owner.
     */
    constructor () internal {
        address msgSender = _msgSender();
        _owner = msgSender;
        emit OwnershipTransferred(address(0), msgSender);
    }

    /**
     * @dev Returns the address of the current owner.
     */
    function owner() public view returns (address) {
        return _owner;
    }

    /**
     * @dev Throws if called by any account other than the owner.
     */
    modifier onlyOwner() {
        require(isOwner(), "Ownable: caller is not the owner");
        _;
    }

    /**
     * @dev Returns true if the caller is the current owner.
     */
    function isOwner() public view returns (bool) {
        return _msgSender() == _owner;
    }

    /**
     * @dev Leaves the contract without owner. It will not be possible to call
     * `onlyOwner` functions anymore. Can only be called by the current owner.
     *
     * NOTE: Renouncing ownership will leave the contract without an owner,
     * thereby removing any functionality that is only available to the owner.
     */
    function renounceOwnership() public onlyOwner {
        emit OwnershipTransferred(_owner, address(0));
        _owner = address(0);
    }

    /**
     * @dev Transfers ownership of the contract to a new account (`newOwner`).
     * Can only be called by the current owner.
     */
    function transferOwnership(address newOwner) public onlyOwner {
        _transferOwnership(newOwner);
    }

    /**
     * @dev Transfers ownership of the contract to a new account (`newOwner`).
     */
    function _transferOwnership(address newOwner) internal {
        require(newOwner != address(0), "ownable: new owner is the zero address");
        emit OwnershipTransferred(_owner, newOwner);
        _owner = newOwner;
    }
}


interface TreatMinter {
    function balanceOf(address owner, uint256 id) external view returns (uint256);
    function safeBatchTransferFrom(address _from, address _to, uint256[] calldata _ids, uint256[] calldata _amounts, bytes calldata _data) external;
}

interface TreatMinterV2 {
    function balanceOf(address owner, uint256 id) external view returns (uint256);
    function safeBatchTransferFrom(address _from, address _to, uint256[] calldata _ids, uint256[] calldata _amounts, bytes calldata _data) external;
}


contract TreatTradeIn is Ownable {
    using SafeMath for uint256;
    TreatMinterV2 public treatMinterV2;
    TreatMinter public treatMinter;
    address payable tradeInAddress;
    event Redeemed(address indexed user);

    constructor(TreatMinterV2 _TreatMinterV2Address, TreatMinter _TreatMinterAddress, address payable _TradeInAddress) public {
        treatMinterV2 = _TreatMinterV2Address;
        treatMinter = _TreatMinterAddress;
        tradeInAddress = _TradeInAddress;
    }    
    
    function tradeInMultiple(uint256[] memory _treatIds, uint256[] memory _amounts) public {
        for (uint256 i = 0; i < _treatIds.length; ++i) {
            require(treatMinter.balanceOf(msg.sender, _treatIds[i]) >= _amounts[i], "not enough Treat to redeem for a Treat");
            require(treatMinterV2.balanceOf(tradeInAddress, _treatIds[i]) >= _amounts[i], "max treat nfts redeemed");
        }

        treatMinter.safeBatchTransferFrom(msg.sender, tradeInAddress, _treatIds, _amounts, "");
        treatMinterV2.safeBatchTransferFrom(tradeInAddress, msg.sender, _treatIds, _amounts, "");
        emit Redeemed(msg.sender);
    }



    function onERC1155Received(address _operator, address _from, uint256 _id, uint256 _amount, bytes calldata _data) external returns(bytes4) {
        return 0xf23a6e61;
    }
    
    function onERC1155BatchReceived(address _operator, address _from, uint256[] calldata _ids, uint256[] calldata _amounts, bytes calldata _data) external returns(bytes4) {
        return 0xbc197c81;
    }

    function supportsInterface(bytes4 interfaceID) external view returns (bool) {
        return  interfaceID == 0x01ffc9a7 ||    // ERC-165 support (i.e. `bytes4(keccak256('supportsInterface(bytes4)'))`).
        interfaceID == 0x4e2312e0;      // ERC-1155 `ERC1155TokenReceiver` support (i.e. `bytes4(keccak256("onERC1155Received(address,address,uint256,uint256,bytes)")) ^ bytes4(keccak256("onERC1155BatchReceived(address,address,uint256[],uint256[],bytes)"))`).
    }
}